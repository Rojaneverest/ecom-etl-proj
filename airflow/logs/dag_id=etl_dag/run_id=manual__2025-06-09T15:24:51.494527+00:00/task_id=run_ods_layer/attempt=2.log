[2025-06-09T15:26:47.855+0000] {taskinstance.py:1956} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: etl_dag.run_ods_layer manual__2025-06-09T15:24:51.494527+00:00 [queued]>
[2025-06-09T15:26:47.859+0000] {taskinstance.py:1956} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: etl_dag.run_ods_layer manual__2025-06-09T15:24:51.494527+00:00 [queued]>
[2025-06-09T15:26:47.860+0000] {taskinstance.py:2170} INFO - Starting attempt 2 of 3
[2025-06-09T15:26:47.865+0000] {taskinstance.py:2191} INFO - Executing <Task(BashOperator): run_ods_layer> on 2025-06-09 15:24:51.494527+00:00
[2025-06-09T15:26:47.871+0000] {standard_task_runner.py:60} INFO - Started process 1279 to run task
[2025-06-09T15:26:47.882+0000] {standard_task_runner.py:87} INFO - Running: ['***', 'tasks', 'run', 'etl_dag', 'run_ods_layer', 'manual__2025-06-09T15:24:51.494527+00:00', '--job-id', '216', '--raw', '--subdir', 'DAGS_FOLDER/etl_dag.py', '--cfg-path', '/tmp/tmp1zh6avdg']
[2025-06-09T15:26:47.883+0000] {standard_task_runner.py:88} INFO - Job 216: Subtask run_ods_layer
[2025-06-09T15:26:47.924+0000] {task_command.py:423} INFO - Running <TaskInstance: etl_dag.run_ods_layer manual__2025-06-09T15:24:51.494527+00:00 [running]> on host ed7c78a1ebb0
[2025-06-09T15:26:47.966+0000] {taskinstance.py:2480} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='etl_dag' AIRFLOW_CTX_TASK_ID='run_ods_layer' AIRFLOW_CTX_EXECUTION_DATE='2025-06-09T15:24:51.494527+00:00' AIRFLOW_CTX_TRY_NUMBER='2' AIRFLOW_CTX_DAG_RUN_ID='manual__2025-06-09T15:24:51.494527+00:00'
[2025-06-09T15:26:47.967+0000] {subprocess.py:63} INFO - Tmp dir root location: /tmp
[2025-06-09T15:26:47.968+0000] {subprocess.py:75} INFO - Running command: ['/usr/bin/bash', '-c', 'cd /opt/***/ecom_etl && python ods_layer.py']
[2025-06-09T15:26:47.974+0000] {subprocess.py:86} INFO - Output:
[2025-06-09T15:26:48.592+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:48,592 - ods_snowflake_copy_script - INFO - --- Starting Enhanced ODS Ingestion Script for Snowflake (with Timestamp Handling) ---
[2025-06-09T15:26:48.685+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:48,685 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.6.0, Python Version: 3.8.18, Platform: Linux-6.10.14-linuxkit-aarch64-with-glibc2.34
[2025-06-09T15:26:48.685+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:48,685 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
[2025-06-09T15:26:50.223+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:50,221 - ods_snowflake_copy_script - INFO - Successfully connected to Snowflake.
[2025-06-09T15:26:50.228+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:50,221 - ods_snowflake_copy_script - INFO - Creating ECOM_ODS database if it doesn't exist...
[2025-06-09T15:26:50.229+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:50,222 - snowflake.connector.cursor - INFO - query: [CREATE DATABASE IF NOT EXISTS ECOM_ODS]
[2025-06-09T15:26:50.563+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:50,563 - snowflake.connector.cursor - INFO - query execution done
[2025-06-09T15:26:50.563+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:50,563 - snowflake.connector.cursor - INFO - Number of results in first chunk: 1
[2025-06-09T15:26:50.564+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:50,563 - snowflake.connector.cursor - INFO - query: [USE DATABASE ECOM_ODS]
[2025-06-09T15:26:50.965+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:50,964 - snowflake.connector.cursor - INFO - query execution done
[2025-06-09T15:26:50.965+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:50,965 - snowflake.connector.cursor - INFO - Number of results in first chunk: 1
[2025-06-09T15:26:50.966+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:50,965 - ods_snowflake_copy_script - INFO - Creating PUBLIC schema if it doesn't exist...
[2025-06-09T15:26:50.966+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:50,965 - snowflake.connector.cursor - INFO - query: [CREATE SCHEMA IF NOT EXISTS PUBLIC]
[2025-06-09T15:26:51.299+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:51,298 - snowflake.connector.cursor - INFO - query execution done
[2025-06-09T15:26:51.299+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:51,299 - snowflake.connector.cursor - INFO - Number of results in first chunk: 1
[2025-06-09T15:26:51.300+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:51,299 - snowflake.connector.cursor - INFO - query: [USE SCHEMA PUBLIC]
[2025-06-09T15:26:51.684+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:51,683 - snowflake.connector.cursor - INFO - query execution done
[2025-06-09T15:26:51.686+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:51,684 - snowflake.connector.cursor - INFO - Number of results in first chunk: 1
[2025-06-09T15:26:51.686+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:51,684 - ods_snowflake_copy_script - INFO - Database and schema setup completed successfully.
[2025-06-09T15:26:51.687+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:51,684 - snowflake.connector.cursor - INFO - query: [USE DATABASE ECOM_ODS]
[2025-06-09T15:26:52.092+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:52,092 - snowflake.connector.cursor - INFO - query execution done
[2025-06-09T15:26:52.093+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:52,092 - snowflake.connector.cursor - INFO - Number of results in first chunk: 1
[2025-06-09T15:26:52.093+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:52,092 - snowflake.connector.cursor - INFO - query: [USE SCHEMA PUBLIC]
[2025-06-09T15:26:52.428+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:52,428 - snowflake.connector.cursor - INFO - query execution done
[2025-06-09T15:26:52.428+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:52,428 - snowflake.connector.cursor - INFO - Number of results in first chunk: 1
[2025-06-09T15:26:52.429+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:52,428 - snowflake.connector.cursor - INFO - query: [CREATE OR REPLACE FILE FORMAT PARQUET_FORMAT_WITH_TIMESTAMP_HANDLING TYPE = 'PAR...]
[2025-06-09T15:26:52.807+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:52,807 - snowflake.connector.cursor - INFO - query execution done
[2025-06-09T15:26:52.811+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:52,811 - ods_snowflake_copy_script - ERROR - Error creating external stage: 002135 (42601): 01bcea9e-0000-2033-0000-0017048bf6fd: SQL compilation error:
[2025-06-09T15:26:52.812+0000] {subprocess.py:93} INFO - Option ERROR_ON_COLUMN_COUNT_MISMATCH is not valid for file format type PARQUET.
[2025-06-09T15:26:52.812+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:52,811 - ods_snowflake_copy_script - ERROR - An error occurred in the main process: 002135 (42601): 01bcea9e-0000-2033-0000-0017048bf6fd: SQL compilation error:
[2025-06-09T15:26:52.813+0000] {subprocess.py:93} INFO - Option ERROR_ON_COLUMN_COUNT_MISMATCH is not valid for file format type PARQUET.
[2025-06-09T15:26:52.813+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:52,811 - snowflake.connector.connection - INFO - closed
[2025-06-09T15:26:53.115+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:53,114 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
[2025-06-09T15:26:53.432+0000] {subprocess.py:93} INFO - 2025-06-09 15:26:53,431 - ods_snowflake_copy_script - INFO - Snowflake connection closed.
[2025-06-09T15:26:53.435+0000] {subprocess.py:93} INFO - Traceback (most recent call last):
[2025-06-09T15:26:53.435+0000] {subprocess.py:93} INFO -   File "ods_layer.py", line 546, in <module>
[2025-06-09T15:26:53.436+0000] {subprocess.py:93} INFO -     main()
[2025-06-09T15:26:53.436+0000] {subprocess.py:93} INFO -   File "ods_layer.py", line 490, in main
[2025-06-09T15:26:53.437+0000] {subprocess.py:93} INFO -     create_external_stage(conn)
[2025-06-09T15:26:53.437+0000] {subprocess.py:93} INFO -   File "ods_layer.py", line 237, in create_external_stage
[2025-06-09T15:26:53.438+0000] {subprocess.py:93} INFO -     cursor.execute(file_format_sql)
[2025-06-09T15:26:53.438+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/snowflake/connector/cursor.py", line 1132, in execute
[2025-06-09T15:26:53.440+0000] {subprocess.py:93} INFO -     Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
[2025-06-09T15:26:53.440+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/snowflake/connector/errors.py", line 290, in errorhandler_wrapper
[2025-06-09T15:26:53.440+0000] {subprocess.py:93} INFO -     handed_over = Error.hand_to_other_handler(
[2025-06-09T15:26:53.441+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/snowflake/connector/errors.py", line 345, in hand_to_other_handler
[2025-06-09T15:26:53.441+0000] {subprocess.py:93} INFO -     cursor.errorhandler(connection, cursor, error_class, error_value)
[2025-06-09T15:26:53.442+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/snowflake/connector/errors.py", line 221, in default_errorhandler
[2025-06-09T15:26:53.442+0000] {subprocess.py:93} INFO -     raise error_class(
[2025-06-09T15:26:53.442+0000] {subprocess.py:93} INFO - snowflake.connector.errors.ProgrammingError: 002135 (42601): 01bcea9e-0000-2033-0000-0017048bf6fd: SQL compilation error:
[2025-06-09T15:26:53.443+0000] {subprocess.py:93} INFO - Option ERROR_ON_COLUMN_COUNT_MISMATCH is not valid for file format type PARQUET.
[2025-06-09T15:26:53.647+0000] {subprocess.py:97} INFO - Command exited with return code 1
[2025-06-09T15:26:53.672+0000] {taskinstance.py:2698} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/models/taskinstance.py", line 433, in _execute_task
    result = execute_callable(context=context, **execute_callable_kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/bash.py", line 212, in execute
    raise AirflowException(
airflow.exceptions.AirflowException: Bash command failed. The command returned a non-zero exit code 1.
[2025-06-09T15:26:53.677+0000] {taskinstance.py:1138} INFO - Marking task as UP_FOR_RETRY. dag_id=etl_dag, task_id=run_ods_layer, execution_date=20250609T152451, start_date=20250609T152647, end_date=20250609T152653
[2025-06-09T15:26:53.691+0000] {standard_task_runner.py:107} ERROR - Failed to execute job 216 for task run_ods_layer (Bash command failed. The command returned a non-zero exit code 1.; 1279)
[2025-06-09T15:26:53.733+0000] {local_task_job_runner.py:234} INFO - Task exited with return code 1
[2025-06-09T15:26:53.760+0000] {taskinstance.py:3280} INFO - 0 downstream tasks scheduled from follow-on schedule check
